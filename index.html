<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zivoon Books</title>
  <style>
    :root{
      --brand:#2f5bea;       /* بدلي غير هاد اللون */
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#1f2330;
      --muted:#6b7280;
      --line:#e7eaf2;
      --shadow:0 10px 25px rgba(18, 28, 45, .08);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{position:sticky;top:0;z-index:20;background:var(--brand);color:#fff;box-shadow:0 8px 24px rgba(47,91,234,.25);}
    .top{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:14px;}
    .logo{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px;font-size:18px;cursor:pointer;user-select:none;}
    .dot{width:12px;height:12px;border-radius:50%;background:#fff;opacity:.9;box-shadow:0 0 0 4px rgba(255,255,255,.18);}
    .search{flex:1;display:flex;gap:10px;align-items:center;}
    .search input{width:100%;border:none;outline:none;padding:10px 12px;border-radius:999px;background:rgba(255,255,255,.92);color:#111827;font-size:14px;}
    .nav{display:flex;align-items:center;gap:10px;}
    .pill{border:1px solid rgba(255,255,255,.35);background:rgba(255,255,255,.15);color:#fff;padding:8px 12px;border-radius:999px;font-size:13px;cursor:pointer;user-select:none;white-space:nowrap;text-decoration:none;display:inline-flex;align-items:center}
    .pill:hover{background:rgba(255,255,255,.22);}
    .wrap{max-width:1100px;margin:18px auto;padding:0 16px 40px;display:grid;grid-template-columns:260px 1fr;gap:16px;}
    @media (max-width:860px){.wrap{grid-template-columns:1fr}.side{order:2}}
    .side{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;height:fit-content;}
    .side h3{margin:0 0 10px;font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;}
    .cat{display:flex;justify-content:space-between;align-items:center;padding:10px 10px;border-radius:12px;cursor:pointer;border:1px solid transparent;margin-bottom:6px;}
    .cat:hover{background:#f7f8ff;}
    .cat.active{background:#eef2ff;border-color:#dbe3ff;}
    .badge{font-size:12px;color:var(--muted);background:#f3f4f6;border:1px solid #e5e7eb;padding:2px 8px;border-radius:999px;}
    .main{display:flex;flex-direction:column;gap:12px;}
    .panel{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;}
    .titleRow{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;}
    .titleRow h2{margin:0;font-size:18px;}
    .hint{color:var(--muted);font-size:13px;}
    .grid{margin-top:12px;display:grid;grid-template-columns:repeat(4,1fr);gap:12px;}
    @media (max-width:1040px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:700px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:420px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:16px;background:#fff;overflow:hidden;cursor:pointer;transition:.15s transform ease,.15s box-shadow ease;display:flex;flex-direction:column;min-height:290px;}
    .card:hover{transform:translateY(-3px);box-shadow:0 14px 30px rgba(18,28,45,.12);}
    .cover{height:170px;background:#eef2ff;display:flex;align-items:center;justify-content:center;}
    .cover img{width:110px;height:150px;object-fit:cover;border-radius:10px;box-shadow:0 10px 20px rgba(0,0,0,.18);border:1px solid rgba(0,0,0,.06);background:#fff;}
    .meta{padding:10px 12px 12px;display:flex;flex-direction:column;gap:6px;}
    .bookTitle{font-weight:800;font-size:14px;line-height:1.25;margin:0;}
    .author{margin:0;font-size:13px;color:var(--muted);}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:auto;}
    .stars{font-size:12px;color:#f59e0b;letter-spacing:1px;white-space:nowrap;}
    .rating{font-size:12px;color:var(--muted);white-space:nowrap;}
    .tag{display:inline-flex;align-items:center;gap:6px;font-size:12px;padding:5px 10px;border-radius:999px;background:#f3f4f6;border:1px solid #e5e7eb;color:#111827;width:fit-content;}
    footer{max-width:1100px;margin:0 auto;padding:12px 16px 30px;color:var(--muted);font-size:12px;}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(15,23,42,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:50;}
    .overlay.show{display:flex;}
    .modal{width:min(900px,100%);background:#fff;border-radius:18px;overflow:hidden;box-shadow:0 30px 70px rgba(0,0,0,.25);}
    .modalHead{display:flex;justify-content:space-between;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--line);background:#fff;}
    .closeBtn{border:none;background:#f3f4f6;border:1px solid #e5e7eb;padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:700;}
    .modalBody{display:grid;grid-template-columns:260px 1fr;gap:14px;padding:14px;}
    @media (max-width:780px){.modalBody{grid-template-columns:1fr}}
    .bigCover{background:#eef2ff;border-radius:16px;padding:14px;display:flex;justify-content:center;align-items:center;border:1px solid #dbe3ff;}
    .bigCover img{width:180px;height:250px;object-fit:cover;border-radius:12px;box-shadow:0 16px 30px rgba(0,0,0,.18);border:1px solid rgba(0,0,0,.06);background:#fff;}
    .desc h3{margin:0 0 6px;}
    .desc p{margin:0 0 10px;color:#374151;line-height:1.6;}
    .chips{display:flex;flex-wrap:wrap;gap:8px;}
    .chip{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#f9fafb;color:#111827;}
  </style>
</head>

<body>
<header>
  <div class="top">
    <div class="logo" id="goHome" title="Home">
      <span class="dot"></span>
      <span>Zivoon</span>
    </div>

    <div class="search">
      <input id="searchInput" type="search" placeholder="Search books, authors..." />
    </div>

    <div class="nav">
      <a class="pill" href="admin.html">Admin</a>
    </div>
  </div>
</header>

<div class="wrap">
  <aside class="side">
    <h3>Categories</h3>
    <div id="cats"></div>
    <div style="margin-top:14px;padding-top:12px;border-top:1px solid var(--line);">
      <div class="hint" style="line-height:1.5;">
        Click any book to open details.<br/>
        Add books from Admin page.
      </div>
    </div>
  </aside>

  <main class="main">
    <section class="panel">
      <div class="titleRow">
        <h2 id="sectionTitle">Best Books</h2>
        <div class="hint" id="countHint"></div>
      </div>
      <div class="grid" id="grid"></div>
    </section>
  </main>
</div>

<footer>
  © <span id="year"></span> Zivoon
</footer>

<!-- Modal -->
<div class="overlay" id="overlay">
  <div class="modal">
    <div class="modalHead">
      <div style="font-weight:800;" id="mTitle">Book</div>
      <button class="closeBtn" id="closeModal">Close</button>
    </div>
    <div class="modalBody">
      <div class="bigCover"><img id="mCover" alt="cover"/></div>
      <div class="desc">
        <h3 id="mName"></h3>
        <div style="color:var(--muted);font-weight:700;margin-bottom:10px;" id="mAuthor"></div>
        <div class="chips" style="margin-bottom:10px;">
          <span class="chip" id="mCat"></span>
          <span class="chip" id="mRate"></span>
          <span class="chip" id="mStars"></span>
        </div>
        <p id="mDesc"></p>
      </div>
    </div>
  </div>
</div>

<script>
  const STORAGE_KEY = "zivoon_books_v1";

  const defaultBooks = [
    { id:id(), title:"The Hunger Games", author:"Suzanne Collins", category:"Young Adult", rating:4.3,
      cover:"https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1447303603i/2767052.jpg",
      desc:"A dystopian story where Katniss fights for survival in a televised battle and becomes a symbol of rebellion."},
    { id:id(), title:"Harry Potter", author:"J.K. Rowling", category:"Fantasy", rating:4.7,
      cover:"https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1474154022i/3.jpg",
      desc:"A young wizard discovers his magical world, friendship, and an epic fight between good and evil."},
    { id:id(), title:"The Hobbit", author:"J.R.R. Tolkien", category:"Fantasy", rating:4.3,
      cover:"https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1546071216i/5907.jpg",
      desc:"Bilbo Baggins joins a quest with dwarves to reclaim a treasure guarded by a dragon."},
    { id:id(), title:"A Game of Thrones", author:"George R.R. Martin", category:"Epic Fantasy", rating:4.4,
      cover:"https://images-na.ssl-images-amazon.com/images/S/compressed.photo.goodreads.com/books/1562690475i/13496.jpg",
      desc:"Noble houses clash for power in a world of politics, betrayals, and looming ancient threats."}
  ];

  const categories = ["All","Best Books","Fantasy","Epic Fantasy","Young Adult","Romance","Thriller","Business","Self-Help","Biography","History","Science"];

  let books = loadBooks();
  let activeCategory = "All";

  const grid = document.getElementById("grid");
  const catsEl = document.getElementById("cats");
  const sectionTitle = document.getElementById("sectionTitle");
  const countHint = document.getElementById("countHint");
  const searchInput = document.getElementById("searchInput");

  const overlay = document.getElementById("overlay");
  const closeModal = document.getElementById("closeModal");
  const mCover = document.getElementById("mCover");
  const mName = document.getElementById("mName");
  const mAuthor = document.getElementById("mAuthor");
  const mCat = document.getElementById("mCat");
  const mRate = document.getElementById("mRate");
  const mStars = document.getElementById("mStars");
  const mDesc = document.getElementById("mDesc");
  const mTitle = document.getElementById("mTitle");

  document.getElementById("year").textContent = new Date().getFullYear();

  document.getElementById("goHome").addEventListener("click", () => {
    activeCategory = "All";
    searchInput.value = "";
    renderAll();
  });

  searchInput.addEventListener("input", renderAll);

  closeModal.addEventListener("click", () => overlay.classList.remove("show"));
  overlay.addEventListener("click", (e)=>{ if(e.target===overlay) overlay.classList.remove("show"); });
  window.addEventListener("keydown",(e)=>{ if(e.key==="Escape") overlay.classList.remove("show"); });

  renderCategories();
  renderAll();

  function renderAll(){
    renderCategories();
    const filtered = getFilteredBooks();
    sectionTitle.textContent = activeCategory === "All" ? "Best Books" : activeCategory;
    countHint.textContent = ${filtered.length} book(s);
    grid.innerHTML = "";
    filtered.forEach(b => grid.appendChild(bookCard(b)));
  }

  function renderCategories(){
    catsEl.innerHTML = "";
    const counts = countByCategory();
    categories.forEach(cat=>{
      const row = document.createElement("div");
      row.className = "cat" + (cat===activeCategory ? " active": "");
      row.innerHTML = <div style="font-weight:800;">${esc(cat)}</div><div class="badge">${counts[cat]??0}</div>;
      row.onclick = ()=>{ activeCategory=cat; renderAll(); };
      catsEl.appendChild(row);
    });
  }

  function bookCard(b){
    const el = document.createElement("div");
    el.className = "card";
    el.innerHTML = `
      <div class="cover"><img src="${escAttr(b.cover)}" alt="cover"
        onerror="this.src='${escAttr(placeholder(b.title,b.author))}'"/></div>
      <div class="meta">
        <div class="tag">${esc(b.category)}</div>
        <p class="bookTitle">${esc(b.title)}</p>
        <p class="author">${esc(b.author)}</p>
        <div class="row">
          <div class="stars">${stars(b.rating)}</div>
          <div class="rating">${Number(b.rating||0).toFixed(1)}</div>
        </div>
      </div>`;
    el.onclick = ()=>openBook(b);
    return el;
  }

  function openBook(b){
    mTitle.textContent = b.title;
    mCover.src = b.cover;
    mCover.onerror = ()=> (mCover.src = placeholder(b.title,b.author));
    mName.textContent = b.title;
    mAuthor.textContent = b.author;
    mCat.textContent = "Category: " + b.category;
    mRate.textContent = "Rating: " + Number(b.rating||0).toFixed(1) + " / 5";
    mStars.textContent = stars(b.rating||0);
    mDesc.textContent = b.desc || "No description.";
    overlay.classList.add("show");
  }

  function getFilteredBooks(){
    const q = (searchInput.value||"").trim().toLowerCase();
    let list = [...books];

    if(activeCategory !== "All"){
      if(activeCategory !== "Best Books"){
        list = list.filter(b => (b.category||"").toLowerCase() === activeCategory.toLowerCase());
      }
    }
    if(q){
      list = list.filter(b =>
        (b.title||"").toLowerCase().includes(q) ||
        (b.author||"").toLowerCase().includes(q) ||
        (b.category||"").toLowerCase().includes(q)
      );
    }
    return list;
  }

  function countByCategory(){
    const map = {};
    categories.forEach(c=> map[c]=0);
    map["All"] = books.length;
    map["Best Books"] = books.length;
    books.forEach(b=>{
      const c = b.category || "Other";
      map[c] = (map[c]||0) + 1;
    });
    return map;
  }

  function loadBooks(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return defaultBooks;
      const parsed = JSON.parse(raw);
      if(!Array.isArray(parsed) || parsed.length===0) return defaultBooks;
      return parsed;
    }catch(e){
      return defaultBooks;
    }
  }

  function stars(r){
    r = Number(r||0);
    const full = Math.floor(r);
    const half = (r-full) >= 0.5 ? 1 : 0;
    const empty = 5 - full - half;
    return "★".repeat(full) + (half ? "☆" : "") + "✩".repeat(empty);
  }
  function esc(s){return String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");}
  function escAttr(s){return esc(s).replaceAll("\n"," ");}

  function placeholder(title, author){
    const svg = `
      <svg xmlns="http://www.w3.org/2000/svg" width="360" height="520">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#eef2ff"/>
            <stop offset="1" stop-color="#dbeafe"/>
          </linearGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#g)"/>
        <rect x="28" y="28" width="304" height="464" rx="18" fill="#ffffff" opacity="0.9"/>
        <text x="50%" y="46%" text-anchor="middle" font-family="Arial" font-size="28" font-weight="800" fill="#1f2330">
          ${(String(title||"Book").replaceAll("&","and").replaceAll("<","").replaceAll(">",""))}
        </text>
        <text x="50%" y="54%" text-anchor="middle" font-family="Arial" font-size="18" font-weight="700" fill="#6b7280">
          ${(String(author||"").replaceAll("&","and").replaceAll("<","").replaceAll(">",""))}
        </text>
        <text x="50%" y="90%" text-anchor="middle" font-family="Arial" font-size="14" font-weight="700" fill="#2f5bea">Zivoon</text>
      </svg>`;
    return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg);
  }

  function id(){
    const a = new Uint32Array(2);
    (crypto).getRandomValues(a);
    return a[0].toString(16) + "-" + a[1].toString(16);
  }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Zivoon Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --brand:#8b0000;
      --bg:#0f0f0f;
      --card:#161616;
      --text:#f1f1f1;
      --muted:#b3b3b3;
      --border:#2a2a2a;
      --ok:#16a34a;
      --bad:#dc2626;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      background: linear-gradient(90deg, #8b0000, #4a0000);
      padding:16px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    header .title{font-weight:900; letter-spacing:.5px}
    header a{
      color:#fff; text-decoration:none;
      background: rgba(255,255,255,.14);
      padding:8px 14px; border-radius:999px;
      font-size:14px;
    }

    .wrap{
      max-width:1100px;
      margin:22px auto;
      padding:0 16px 40px;
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:16px;
    }
    @media (max-width:920px){ .wrap{grid-template-columns:1fr;} }

    .panel{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:16px;
    }
    h2{margin:0 0 12px 0; font-size:18px}
    .small{color:var(--muted); font-size:13px; line-height:1.5}

    input, select, textarea, button{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#101010;
      color:var(--text);
      outline:none;
      font-size:14px;
      margin-top:8px;
    }
    textarea{min-height:92px; resize:vertical;}
    button{
      cursor:pointer;
      border:none;
      font-weight:800;
    }
    .btnPrimary{background:var(--brand);}
    .btnPrimary:hover{filter:brightness(1.05)}
    .btnGhost{
      background:transparent;
      border:1px solid var(--border);
    }
    .btnDanger{background:var(--bad)}
    .btnDanger:hover{filter:brightness(1.05)}

    .row{display:flex; gap:10px; margin-top:10px}
    .row > *{flex:1}
    .hide{display:none}

    .msg{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      border:1px solid var(--border);
      background:#111;
      color:var(--muted);
    }
    .msg.ok{border-color: rgba(22,163,74,.5); color:#bbf7d0}
    .msg.bad{border-color: rgba(220,38,38,.6); color:#fecaca}

    .list{display:flex; flex-direction:column; gap:10px; margin-top:12px}
    .item{
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      background:#121212;
    }
    .thumb{
      width:62px; height:86px;
      border-radius:10px;
      border:1px solid var(--border);
      object-fit:cover;
      background:#0b0b0b;
      flex:0 0 auto;
    }
    .info{flex:1}
    .info .t{font-weight:900; margin:0 0 4px 0}
    .info .m{color:var(--muted); font-size:13px; margin:0}
    .info .d{color:#ddd; font-size:13px; margin:8px 0 0 0; line-height:1.5}
    .actions{display:flex; gap:8px; margin-top:10px; flex-wrap:wrap}
    .actions button{width:auto; padding:8px 10px; border-radius:12px; font-size:13px}
    .tag{
      display:inline-block;
      margin-top:8px;
      padding:4px 10px;
      background: rgba(139,0,0,.25);
      border:1px solid rgba(139,0,0,.5);
      border-radius:999px;
      font-size:12px;
      color:#fff;
      width:fit-content;
    }
  </style>
</head>

<body>
<header>
  <div class="title">Zivoon Admin</div>
  <a href="./index.html">Back to site</a>
</header>

<div class="wrap">

  <!-- LOGIN -->
  <section class="panel" id="loginPanel">
    <h2>Login</h2>
    <div class="small">Enter your admin code to manage books.</div>

    <input type="password" id="adminCode" placeholder="Admin code" autocomplete="off" />
    <button class="btnPrimary" id="unlockBtn">Unlock</button>

    <div id="loginMsg" class="msg">Tip: keep your code private.</div>
  </section>

  <!-- ADMIN -->
  <section class="panel hide" id="adminPanel">
    <h2 id="formTitle">Add Book</h2>
    <div class="small" id="formHint">Fill the fields and click “Save Book”.</div>

    <input type="text" id="title" placeholder="Book title" />
    <input type="text" id="author" placeholder="Author" />

    <select id="category">
      <option>Best Books</option>
      <option>New</option>
      <option>Popular</option>
    </select>

    <input type="text" id="price" placeholder="Price (e.g. 7.99)" />
    <input type="text" id="rating" placeholder="Rating (0 - 5) e.g. 4.7" />
    <input type="text" id="cover" placeholder="Cover image URL (https://...jpg)" />
    <textarea id="desc" placeholder="Description (EN + AR)"></textarea>

    <div class="row">
      <button class="btnPrimary" id="saveBtn">Save Book</button>
      <button class="btnGhost" id="cancelBtn">Cancel Edit</button>
    </div>

    <div class="row">
      <button class="btnGhost" id="clearAllBtn">Clear ALL books</button>
      <button class="btnGhost" id="logoutBtn">Logout</button>
    </div>

    <div id="adminMsg" class="msg">Your changes are saved on this device (localStorage).</div>
  </section>

  <!-- LIST -->
  <section class="panel hide" id="listPanel">
    <h2>My Books</h2>
    <div class="small">Edit or delete any book below.</div>
    <div id="booksList" class="list"></div>
  </section>

</div>

<script>
  // ====== CONFIG ======
  const ADMIN_CODE = "ZIVOON-ADMIN-2025";     // بدليه للكود ديالك
  const STORAGE_KEY = "zivoon_books";         // خاصو يطابق index.html

  // ====== STATE ======
  let editingId = null;

  // ====== ELEMENTS ======
  const loginPanel = document.getElementById("loginPanel");
  const adminPanel = document.getElementById("adminPanel");
  const listPanel  = document.getElementById("listPanel");

  const adminCode = document.getElementById("adminCode");
  const unlockBtn = document.getElementById("unlockBtn");
  const loginMsg  = document.getElementById("loginMsg");

  const titleEl = document.getElementById("title");
  const authorEl = document.getElementById("author");
  const catEl = document.getElementById("category");
  const priceEl = document.getElementById("price");
  const ratingEl = document.getElementById("rating");
  const coverEl = document.getElementById("cover");
  const descEl = document.getElementById("desc");

  const saveBtn = document.getElementById("saveBtn");
  const cancelBtn = document.getElementById("cancelBtn");
  const clearAllBtn = document.getElementById("clearAllBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  const formTitle = document.getElementById("formTitle");
  const formHint = document.getElementById("formHint");
  const adminMsg = document.getElementById("adminMsg");

  const booksList = document.getElementById("booksList");

  // ====== HELPERS ======
  function loadBooks(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      const arr = JSON.parse(raw || "[]");
      return Array.isArray(arr) ? arr : [];
    }catch(e){
      return [];
    }
  }

  function saveBooks(list){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
  }

  function showMsg(el, text, type){
    el.classList.remove("ok","bad");
    if(type) el.classList.add(type);
    el.textContent = text;
  }

  function resetForm(){
    editingId = null;
    titleEl.value = "";
    authorEl.value = "";
    catEl.value = "Best Books";
    priceEl.value = "";
    ratingEl.value = "";
    coverEl.value = "";
    descEl.value = "";

    formTitle.textContent = "Add Book";
    formHint.textContent = "Fill the fields and click “Save Book”.";
    cancelBtn.disabled = true;
    cancelBtn.style.opacity = .6;
  }

  function esc(s){
    return String(s ?? "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function safeCover(url){
    const u = String(url || "").trim();
    if(!u) return "https://dummyimage.com/200x280/111/888&text=Cover";
    return u;
  }

  // ====== RENDER LIST ======
  function renderList(){
    const list = loadBooks();
    if(!list.length){
      booksList.innerHTML = "<div class='msg'>No books yet.</div>";
      return;
    }

    booksList.innerHTML = "";
    list.forEach(b => {
      const div = document.createElement("div");
      div.className = "item";

      const img = document.createElement("img");
      img.className = "thumb";
      img.src = safeCover(b.cover);
      img.onerror = () => img.src = "https://dummyimage.com/200x280/111/888&text=Cover";

      const info = document.createElement("div");
      info.className = "info";
      info.innerHTML = `
        <p class="t">${esc(b.title || "Untitled")}</p>
        <p class="m">${esc(b.author || "")} • ${esc(b.category || "")}</p>
        <div class="tag">Price: ${esc(b.price || "—")} • Rating: ${esc(b.rating || "—")}</div>
        <p class="d">${esc((b.desc || "").slice(0,160))}${(b.desc || "").length>160 ? "..." : ""}</p>
      `;

      const actions = document.createElement("div");
      actions.className = "actions";

      const btnEdit = document.createElement("button");
      btnEdit.className = "btnGhost";
      btnEdit.textContent = "Edit";
      btnEdit.onclick = () => startEdit(b.id);

      const btnDel = document.createElement("button");
      btnDel.className = "btnDanger";
      btnDel.textContent = "Delete";
      btnDel.onclick = () => deleteBook(b.id);

      actions.appendChild(btnEdit);
      actions.appendChild(btnDel);
      info.appendChild(actions);

      div.appendChild(img);
      div.appendChild(info);
      booksList.appendChild(div);
    });
  }

  // ====== CRUD ======
  function startEdit(id){
    const list = loadBooks();
    const b = list.find(x => String(x.id) === String(id));
    if(!b) return;

    editingId = b.id;
    titleEl.value = b.title || "";
    authorEl.value = b.author || "";
    catEl.value = b.category || "Best Books";
    priceEl.value = b.price || "";
    ratingEl.value = b.rating || "";
    coverEl.value = b.cover || "";
    descEl.value = b.desc || "";

    formTitle.textContent = "Edit Book";
    formHint.textContent = "Update fields and click “Save Book”.";
    cancelBtn.disabled = false;
    cancelBtn.style.opacity = 1;

    showMsg(adminMsg, "Editing mode enabled ✅", "ok");
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function deleteBook(id){
    const ok = confirm("Delete this book?");
    if(!ok) return;

    const list = loadBooks().filter(x => String(x.id) !== String(id));
    saveBooks(list);

    if(String(editingId) === String(id)) resetForm();

    showMsg(adminMsg, "Book deleted ✔", "ok");
    renderList();
  }

  function upsertBook(){
    const title = titleEl.value.trim();
    const author = authorEl.value.trim();
    const category = catEl.value;
    const price = priceEl.value.trim();
    const rating = ratingEl.value.trim();
    const cover = coverEl.value.trim();
    const desc = descEl.value.trim();

    if(!title || !author){
      showMsg(adminMsg, "Title and Author are required.", "bad");
      return;
    }

    // validate rating if entered
    if(rating){
      const r = Number(rating);
      if(Number.isNaN(r) || r < 0 || r > 5){
        showMsg(adminMsg, "Rating must be between 0 and 5.", "bad");
        return;
      }
    }
    // validate price if entered
    if(price){
      const p = Number(price);
      if(Number.isNaN(p) || p < 0){
        showMsg(adminMsg, "Price must be a positive number.", "bad");
        return;
      }
    }

    const list = loadBooks();

    if(editingId){
      const idx = list.findIndex(x => String(x.id) === String(editingId));
      if(idx !== -1){
        list[idx] = {
          ...list[idx],
          title, author, category,
          price, rating,
          cover, desc
        };
        saveBooks(list);
        showMsg(adminMsg, "Book updated ✔", "ok");
      } else {
        showMsg(adminMsg, "Could not find book to update.", "bad");
      }
    } else {
      const book = {
        id: Date.now(),
        title, author, category,
        price, rating,
        cover, desc
      };
      list.unshift(book);
      saveBooks(list);
      showMsg(adminMsg, "Book added ✔", "ok");
    }

    resetForm();
    renderList();
  }

  function clearAll(){
    const ok = confirm("This will delete ALL books on this device. Continue?");
    if(!ok) return;
    localStorage.removeItem(STORAGE_KEY);
    resetForm();
    renderList();
    showMsg(adminMsg, "All books cleared ✔", "ok");
  }

  // ====== LOGIN / LOGOUT ======
  function unlock(){
    const v = adminCode.value.trim();
    if(v === ADMIN_CODE){
      loginPanel.classList.add("hide");
      adminPanel.classList.remove("hide");
      listPanel.classList.remove("hide");
      resetForm();
      renderList();
      showMsg(loginMsg, "Unlocked ✅", "ok");
    } else {
      showMsg(loginMsg, "Wrong code ❌", "bad");
    }
  }

  function logout(){
    adminCode.value = "";
    loginPanel.classList.remove("hide");
    adminPanel.classList.add("hide");
    listPanel.classList.add("hide");
    showMsg(loginMsg, "Logged out.", "");
  }

  // ====== EVENTS ======
  unlockBtn.addEventListener("click", unlock);
  adminCode.addEventListener("keydown", (e)=>{ if(e.key==="Enter") unlock(); });

  saveBtn.addEventListener("click", upsertBook);
  cancelBtn.addEventListener("click", ()=>{ resetForm(); showMsg(adminMsg, "Edit cancelled.", ""); });
  clearAllBtn.addEventListener("click", clearAll);
  logoutBtn.addEventListener("click", logout);

  // default
  cancelBtn.disabled = true;
  cancelBtn.style.opacity = .6;
</script>

</body>
</html>
